<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Visulization of Multilevel Modeling | Haotian Zhao </title> <meta name="author" content="Haotian Zhao"> <meta name="description" content="A visual guide to multilevel modeling, showing how MLM handles nested data structures in cross-national research."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%93%A1&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://haotianzhao99.github.io/projects/mlmvisualization/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Haotian</span> Zhao </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">home </a> </li> <li class="nav-item "> <a class="nav-link" href="/academicpapers/">academic papers </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Visulization of Multilevel Modeling</h1> <p class="post-description">A visual guide to multilevel modeling, showing how MLM handles nested data structures in cross-national research.</p> </header> <article> <h1 id="introduction-to-multilevel-modeling">Introduction to Multilevel Modeling</h1> <p>Multilevel modeling (MLM), also known as hierarchical linear modeling or mixed-effects modeling, is a sophisticated statistical approach designed to analyze hierarchically structured or nested data. This method has become increasingly vital in social science research, particularly when dealing with data organized across multiple levels of analysis.</p> <h2 id="simpsons-paradox-and-the-need-for-mlm">Simpson’s Paradox and the Need for MLM</h2> <p>One of the most compelling reasons to employ multilevel modeling (MLM) is its ability to address Simpson’s paradox, a counterintuitive statistical phenomenon that highlights the complex nature of hierarchical data structures. This paradox occurs when a trend or relationship that appears consistently in several groups of data either disappears or, more strikingly, reverses direction when these groups are combined or analyzed at an aggregate level.</p> <p>The paradox fundamentally demonstrates how relationships between variables can be profoundly influenced by the level at which data is analyzed. It reveals that what appears true at one level of analysis may be false at another, challenging our intuitive understanding of causality and correlation. This makes it particularly problematic for researchers who need to draw accurate conclusions from nested or hierarchically structured data.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm1.png" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Source: <a href="https://towardsdatascience.com/simpsons-paradox-and-interpreting-data-6a0443516765" rel="external nofollow noopener" target="_blank">Grigg (2018)</a></p> <p>Multilevel modeling’s value becomes particularly clear when we consider real-world scenarios like the famous 1975 University of California, Berkeley graduate admissions study. This case perfectly illustrates how data analyzed at different levels can tell seemingly contradictory stories. When researchers examined the aggregate admission rates, they found what appeared to be significant gender discrimination - male applicants had a notably higher overall admission rate (44%) compared to female applicants (35%).</p> <p>However, when the analysis was conducted at the departmental level, this pattern not only disappeared but actually reversed in many cases, with women showing higher admission rates in most individual departments. This apparent contradiction emerged because the analysis failed to account for a crucial hierarchical structure in the data: departments varied significantly in their competitiveness, and female applicants tended to apply to more competitive departments, particularly in the social sciences, while male applicants were more likely to seek admission to less competitive departments, such as those in the natural sciences. This scenario demonstrates why multilevel modeling is essential - it allows researchers to simultaneously account for both individual-level effects and higher-level contextual factors (in this case, departmental differences), preventing misleading conclusions that might arise from analyzing data at only one level. By incorporating the hierarchical nature of the data directly into the analysis, MLM provides a more accurate and nuanced understanding of complex relationships, helping researchers avoid the pitfalls of Simpson’s Paradox and leading to more informed decision-making.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm2.gif" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm2.gif" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Source: <a href="https://www.split.io/glossary/simpsons-paradox/" rel="external nofollow noopener" target="_blank">Split</a></p> <h1 id="multilevel-modeling">Multilevel Modeling</h1> <p>Let’s consider a two-level model:</p> <h2 id="level-1-model-individual-level">Level-1 Model (Individual Level):</h2> \[Y_{ij} = \beta_{0j} + \beta_{1j}X_{ij} + e_{ij}\] <p>Where:</p> <ul> <li>\(Y_{ij}\) is the outcome for individual \(i\) in group \(j\)</li> <li>\(X_{ij}\) is the predictor variable for individual \(i\) in group \(j\)</li> <li>\(\beta_{0j}\) is the intercept for group \(j\)</li> <li>\(\beta_{1j}\) is the slope for group \(j\)</li> <li>\(e_{ij}\) is the individual-level residual, typically assumed \(e_{ij} \sim N(0, \sigma^2)\)</li> </ul> <h2 id="level-2-model-group-level">Level-2 Model (Group Level):</h2> <p>For random intercepts: \(\beta_{0j} = \gamma_{00} + \gamma_{01}W_j + u_{0j}\)</p> <p>For random slopes: \(\beta_{1j} = \gamma_{10} + \gamma_{11}W_j + u_{1j}\)</p> <p>Where:</p> <ul> <li>\(W_j\) is a group-level predictor</li> <li>\(\gamma_{00}\) is the overall intercept</li> <li>\(\gamma_{10}\) is the overall slope</li> <li>\(\gamma_{01}\) and \(\gamma_{11}\) are the effects of group-level predictor on intercepts and slopes</li> <li>\(u_{0j}\) and \(u_{1j}\) are group-level random effects, typically assumed:</li> </ul> \[\begin{pmatrix} u_{0j} \\ u_{1j} \end{pmatrix} \sim N\begin{pmatrix} \begin{pmatrix} 0 \\ 0 \end{pmatrix}, \begin{pmatrix} \tau_{00} &amp; \tau_{01} \\ \tau_{01} &amp; \tau_{11} \end{pmatrix} \end{pmatrix}\] <h2 id="combined-mixed-model">Combined Mixed Model:</h2> <p>Substituting the level-2 equations into the level-1 equation yields:</p> \[Y_{ij} = [\gamma_{00} + \gamma_{01}W_j + u_{0j}] + [\gamma_{10} + \gamma_{11}W_j + u_{1j}]X_{ij} + e_{ij}\] \[Y_{ij} = \gamma_{00} + \gamma_{01}W_j + \gamma_{10}X_{ij} + \gamma_{11}W_jX_{ij} + [u_{0j} + u_{1j}X_{ij} + e_{ij}]\] <p>This combined equation shows:</p> <ul> <li>Fixed effects: \(\gamma_{00}, \gamma_{01}, \gamma_{10}, \gamma_{11}\)</li> <li>Random effects: \(u_{0j}, u_{1j}\)</li> <li>Cross-level interaction: \(\gamma_{11}W_jX_{ij}\)</li> </ul> <h2 id="variance-components">Variance Components:</h2> <p>The total variance in \(Y_{ij}\) can be decomposed into:</p> <p>Level-1 variance: \(\sigma^2\) (within-group)</p> <p>Level-2 variances:</p> <ul> <li>\(\tau_{00}\) (random intercept variance)</li> <li>\(\tau_{11}\) (random slope variance)</li> <li>\(\tau_{01}\) (covariance between random intercepts and slopes)</li> </ul> <h2 id="intraclass-correlation-coefficient-icc">Intraclass Correlation Coefficient (ICC):</h2> <p>The ICC represents the proportion of variance at the group level: \(\text{ICC} = \frac{\tau_{00}}{\tau_{00} + \sigma^2}\)</p> <h2 id="these-equations-help-us-understand">These Equations Help Us Understand:</h2> <ul> <li> <p><strong>Hierarchical Data Structure</strong><br> The model captures the nested structure of the data, where individuals (level 1) are grouped within clusters or groups (level 2). It allows us to analyze how both individual-level and group-level factors influence the outcome.</p> </li> <li> <strong>Fixed and Random Effects</strong> <ul> <li> <em>Fixed effects</em> (e.g., \(\gamma_{00}, \gamma_{10}, \gamma_{01}, \gamma_{11}\)) estimate the overall relationships and provide insights into how predictors at both levels affect the outcome on average.</li> <li> <em>Random effects</em> (e.g., \(u_{0j}, u_{1j}\)) capture variability across groups, indicating how much the intercepts and slopes differ from group to group.</li> </ul> </li> <li> <p><strong>Cross-Level Interactions</strong><br> The term \(\gamma_{11}W_jX_{ij}\) shows how group-level predictors (\(W_j\)) can moderate the effect of individual-level predictors (\(X_{ij}\)), highlighting potential interaction effects across levels.</p> </li> <li> <p><strong>Partitioning Variance</strong><br> The model separates variance into within-group (level-1) variance (\(\sigma^2\)) and between-group (level-2) variances (\(\tau_{00}, \tau_{11}\)). This decomposition helps identify how much of the outcome variation is due to differences within groups versus between groups.</p> </li> <li> <p><strong>Intraclass Correlation Coefficient (ICC)</strong><br> The ICC quantifies the proportion of variance attributable to group-level differences. A higher ICC suggests that group membership plays a significant role in explaining the outcome, emphasizing the need for multilevel modeling.</p> </li> <li> <strong>Correlation Between Intercepts and Slopes</strong><br> The covariance term (\(\tau_{01}\)) indicates whether groups with higher intercepts tend to have steeper or flatter slopes. This can provide insights into how initial levels of the outcome relate to its rate of change across groups.</li> </ul> <h1 id="mlm-in-communication-research">MLM in Communication Research</h1> <p>The application of MLM has proven particularly valuable for cross-national research in communication studies. For example: Cross-National Social Media Studies</p> <p>Diehl, T., Huber, B., Gil de Zúñiga, H., &amp; Liu, J. (2021). Social Media and Beliefs about Climate Change: A Cross-National Analysis of News Use, Political Ideology, and Trust in Science. International Journal of Public Opinion Research, 33(2), 197–213. https://doi.org/10.1093/ijpor/edz040</p> <ul> <li>Examined the relationship between social media use and climate change beliefs across different countries</li> <li>Used random slopes to visualize how social media’s influence varies by national context</li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm3.jpeg" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm3.jpeg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Chan, M., &amp; Yi, J. (2024). Social Media Use and Political Engagement in Polarized Times. Examining the Contextual Roles of Issue and Affective Polarization in Developed Democracies. Political Communication, 1–20. https://doi.org/10.1080/10584609.2024.2325423</p> <ul> <li>Investigated the relationship between social media use and political engagement across the world</li> <li>Conceptualized national issue polarization and affective polarization as contextual factors</li> <li>Explored cross-level interaction effects</li> </ul> <blockquote> <p>The Power of Random Slopes One of MLM’s most powerful features is its ability to accommodate random coefficients. This means that when conducting cross-national analyses, we can observe how the relationship between variables varies across different national contexts. The effect size and direction of relationships can differ significantly from country to country, providing a more nuanced understanding of social phenomena.</p> </blockquote> <h1 id="visualizing-random-slopes-in-r-a-case-study-with-world-values-survey-data">Visualizing Random Slopes in R: A Case Study with World Values Survey Data</h1> <p>When conducting cross-national research using MLM, visualizing random slopes becomes crucial for understanding and communicating results effectively. Here are several strategies for visualizing random slopes in R, each with its own advantages and limitations.</p> <h2 id="introduction-to-the-dataset">Introduction to the Dataset</h2> <p>We’ll walk through a practical example of multilevel modeling using real-world data from Wave 7 of the World Values Survey (WVS). The WVS is a treasure trove of global public opinion data, covering everything from political beliefs to social values across numerous countries. While the full dataset is extensive and could support complex research questions, for our demonstration purposes, we’ll focus on a straightforward yet interesting relationship: how social media use might influence people’s perceptions of science and technology.</p> <p>We selected just four key variables from this rich dataset.</p> <ul> <li>Respondent ID (identifier for each individual)</li> <li>Country Code (identifying the country of each respondent)</li> <li>Social Media Use (frequency of social media usage)</li> <li>Technology Attitude (response to the question “Is the world better off, or worse off, because of science and technology?”)</li> </ul> <p>Let’s first examine our streamlined dataset:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load required package for initial data exploration</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">

</span><span class="c1"># Look at the data structure</span><span class="w">
</span><span class="n">glimpse</span><span class="p">(</span><span class="n">wvs_data</span><span class="p">)</span><span class="w">
</span><span class="c1"># Rows: 91,175</span><span class="w">
</span><span class="c1"># Columns: 5</span><span class="w">
</span><span class="c1"># $ D_INTERVIEW &lt;int&gt; 20070001, 20070002, 20070003, 20070004, 20070005, 20070006, 20070007, 200…</span><span class="w">
</span><span class="c1"># $ country     &lt;chr&gt; "AND", "AND", "AND", "AND", "AND", "AND", "AND", "AND", "AND", "AND", "AN…</span><span class="w">
</span><span class="c1"># $ smu         &lt;int&gt; 5, 1, 5, 5, 2, 5, 1, 1, 5, 1, 1, 5, 4, 1, 1, 3, 1, 5, 5, 1, 1, 2, 1, 1, 1…</span><span class="w">
</span><span class="c1"># $ tech        &lt;int&gt; 6, 10, 5, 6, 6, 10, 7, 9, 8, 2, 9, 6, 7, 6, 9, 4, 6, 5, 7, 3, 8, 5, 6, 8,…</span><span class="w">
</span><span class="c1"># $ predicted   &lt;dbl&gt; 6.373340, 7.127683, 6.373340, 6.373340, 6.939098, 6.373340, 7.127683, 7.1…</span><span class="w">



</span><span class="c1"># Explore technology attitudes by country</span><span class="w">
</span><span class="n">wvs_data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="w">
    </span><span class="n">mean_tech</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">tech</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
    </span><span class="n">sd_tech</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">tech</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
    </span><span class="n">missing_tech</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">tech</span><span class="p">)),</span><span class="w">
    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">()</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="nf">round</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">mean_tech</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w">  
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># # A tibble: 64 × 5</span><span class="w">
</span><span class="c1"># country mean_tech sd_tech missing_tech     n</span><span class="w">
</span><span class="c1"># &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;</span><span class="w">
</span><span class="c1">#   1 CHN          8.64    1.62            0  2976</span><span class="w">
</span><span class="c1"># 2 KGZ          8.51    2.37            0  1169</span><span class="w">
</span><span class="c1"># 3 BGD          8.36    1.73            0  1119</span><span class="w">
</span><span class="c1"># 4 VNM          8.35    1.58            0  1200</span><span class="w">
</span><span class="c1"># 5 UZB          8.31    2.19            0  1201</span><span class="w">
</span><span class="c1"># 6 TJK          8.09    1.96            0  1200</span><span class="w">
</span><span class="c1"># 7 LBY          7.98    2.51            0  1098</span><span class="w">
</span><span class="c1"># 8 IDN          7.8     2.37            0  2973</span><span class="w">
</span><span class="c1"># 9 MDV          7.7     2.09            0  1032</span><span class="w">
</span><span class="c1"># 10 RUS          7.7     1.94            0  1741</span><span class="w">
</span><span class="c1"># 11 UKR          7.67    2.05            0  1207</span><span class="w">
</span><span class="c1"># 12 ETH          7.66    2.99            0  1070</span><span class="w">
</span><span class="c1"># 13 DEU          7.62    2.24            0  1509</span><span class="w">
</span><span class="c1"># 14 NZL          7.62    2.01            0   958</span><span class="w">
</span><span class="c1"># 15 GBR          7.6     2.1             0  2572</span><span class="w">
</span><span class="c1"># 16 KAZ          7.6     1.98            0  1202</span><span class="w">
</span><span class="c1"># 17 USA          7.57    2.23            0  2540</span><span class="w">
</span><span class="c1"># 18 ZWE          7.57    3.07            0  1170</span><span class="w">
</span><span class="c1"># 19 MAR          7.46    2.22            0  1200</span><span class="w">
</span><span class="c1"># 20 PAK          7.45    2.75            0  1882</span><span class="w">
</span><span class="c1"># # ℹ 44 more rows</span><span class="w">
</span><span class="c1"># # ℹ Use `print(n = ...)` to see more rows</span><span class="w">

</span></code></pre></div></div> <h2 id="variable-distributions">Variable Distributions</h2> <p>Before proceeding with multilevel modeling, let’s examine how our key variables are distributed across countries:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create density plots for technology attitudes by country</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">wvs_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">tech</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_density</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"skyblue"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Technology Attitude Score"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Density"</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distribution of Technology Attitudes by Country"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data: World Values Survey Wave 7"</span><span class="p">)</span><span class="w">


</span><span class="c1"># Create density plots for social media use by country</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">wvs_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">smu</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_density</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lightgreen"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Social Media Usage"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Density"</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distribution of Social Media Usage by Country"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Data: World Values Survey Wave 7"</span><span class="p">)</span><span class="w">


</span></code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm4.png" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm4.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm5.png" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm5.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="building-the-multilevel-model">Building the Multilevel Model</h2> <h3 id="the-empty-model">The Empty Model</h3> <p>We start with an empty model (also called null model or intercept-only model) to understand how much variation in technology attitudes exists between countries versus within countries.</p> <p>The model can be written as:</p> \[Y_{ij} = \gamma_{00} + U_{0j} + R_{ij}\] <p>Where:</p> <ul> <li>\(Y_{ij}\): Technology attitude score for individual \(i\) in country \(j\)</li> <li>\(\gamma_{00}\): Overall mean technology attitude across all countries</li> <li>\(U_{0j}\): Random effect for country \(j\) (country-level variance)</li> <li>\(R_{ij}\): Individual-level residual</li> </ul> <p>Let’s fit this model:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load lme4 package for multilevel modeling</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lme4</span><span class="p">)</span><span class="w">

</span><span class="c1"># Fit empty model</span><span class="w">
</span><span class="n">m0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">tech</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wvs_data</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">m0</span><span class="p">)</span><span class="w">

</span><span class="c1"># Linear mixed model fit by REML. t-tests use Satterthwaite's</span><span class="w">
</span><span class="c1">#   method [lmerModLmerTest]</span><span class="w">
</span><span class="c1"># Formula: tech ~ 1 + (1 | country)</span><span class="w">
</span><span class="c1">#    Data: wvs_data</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># REML criterion at convergence: 417429.5</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Scaled residuals: </span><span class="w">
</span><span class="c1">#     Min      1Q  Median      3Q     Max </span><span class="w">
</span><span class="c1"># -3.2032 -0.6107  0.1445  0.7410  1.8554 </span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Random effects:</span><span class="w">
</span><span class="c1">#  Groups   Name        Variance Std.Dev.</span><span class="w">
</span><span class="c1">#  country  (Intercept) 0.5361   0.7322  </span><span class="w">
</span><span class="c1">#  Residual             5.6805   2.3834  </span><span class="w">
</span><span class="c1"># Number of obs: 91175, groups:  country, 64</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Fixed effects:</span><span class="w">
</span><span class="c1">#             Estimate Std. Error       df t value Pr(&gt;|t|)    </span><span class="w">
</span><span class="c1"># (Intercept)  7.03637    0.09191 63.03585   76.56   &lt;2e-16 ***</span><span class="w">
</span><span class="c1"># ---</span><span class="w">
</span><span class="c1"># Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span class="w">



</span><span class="c1"># Calculate ICC using performance package</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">performance</span><span class="p">)</span><span class="w">
</span><span class="n">model_icc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">icc</span><span class="p">(</span><span class="n">m0</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"ICC:"</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">model_icc</span><span class="o">$</span><span class="n">ICC_conditional</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)))</span><span class="w">

</span><span class="c1"># Or calculate ICC manually for verification</span><span class="w">
</span><span class="n">var_random</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">VarCorr</span><span class="p">(</span><span class="n">m0</span><span class="p">))</span><span class="o">$</span><span class="n">vcov</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">var_residual</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">attr</span><span class="p">(</span><span class="n">VarCorr</span><span class="p">(</span><span class="n">m0</span><span class="p">),</span><span class="w"> </span><span class="s2">"sc"</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="w">
</span><span class="n">ICC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">var_random</span><span class="o">/</span><span class="p">(</span><span class="n">var_random</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">var_residual</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"ICC (manual calculation):"</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">ICC</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div> <p>The model shows an overall tech level of 7.04 (p &lt; 0.001) across 64 countries with 91,175 observations. The ICC of 0.086 indicates that only about 8.6% of the total variance in tech scores can be attributed to between-country differences, while the majority of variation (91.4%) exists at the individual level within countries.</p> <h2 id="including-predictors-in-mlm-models">Including Predictors in MLM Models</h2> <p>First, we fitted a random intercepts model that allows baseline technology attitudes to vary across countries while assuming the effect of social media use remains constant:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Model 1: Random intercepts only</span><span class="w">
</span><span class="c1"># This model allows different baseline levels for each country</span><span class="w">
</span><span class="n">m1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">tech</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">smu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wvs_data</span><span class="p">)</span><span class="w">

</span><span class="c1"># Linear mixed model fit by REML. t-tests use Satterthwaite's method ['lmerModLmerTest']</span><span class="w">
</span><span class="c1"># Formula: tech ~ 1 + smu + (1 | country)</span><span class="w">
</span><span class="c1">#    Data: wvs_data</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># REML criterion at convergence: 417344.6</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Scaled residuals: </span><span class="w">
</span><span class="c1">#     Min      1Q  Median      3Q     Max </span><span class="w">
</span><span class="c1"># -3.2311 -0.6251  0.1299  0.7585  1.8916 </span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Random effects:</span><span class="w">
</span><span class="c1">#  Groups   Name        Variance Std.Dev.</span><span class="w">
</span><span class="c1">#  country  (Intercept) 0.5391   0.7343  </span><span class="w">
</span><span class="c1">#  Residual             5.6747   2.3822  </span><span class="w">
</span><span class="c1"># Number of obs: 91175, groups:  country, 64</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Fixed effects:</span><span class="w">
</span><span class="c1">#               Estimate Std. Error         df t value Pr(&gt;|t|)    </span><span class="w">
</span><span class="c1"># (Intercept)  7.158e+00  9.302e-02  6.540e+01  76.955   &lt;2e-16 ***</span><span class="w">
</span><span class="c1"># smu         -4.524e-02  4.671e-03  9.117e+04  -9.685   &lt;2e-16 ***</span><span class="w">
</span><span class="c1"># ---</span><span class="w">
</span><span class="c1"># Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Correlation of Fixed Effects:</span><span class="w">
</span><span class="c1">#     (Intr)</span><span class="w">
</span><span class="c1"># smu -0.135</span><span class="w">

</span></code></pre></div></div> <p>Fixed Effects:</p> <ul> <li>The intercept (7.158) represents the average technology attitude score when social media use is zero -Social media use has a small but significant negative effect (-0.045, <em>p</em> &lt; .001), suggesting that higher social media use is associated with slightly more negative attitudes toward technology</li> </ul> <p>Random Effects:</p> <ul> <li>Country-level variance: 0.539 (SD = 0.734)</li> <li>Residual variance: 5.675 (SD = 2.382)</li> <li>The presence of substantial country-level variance confirms that technology attitudes indeed vary across nations</li> </ul> <p>We then extended our analysis to allow the effect of social media use to vary across countries:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Model 2: Random slopes and intercepts</span><span class="w">
</span><span class="c1"># This model allows both baseline levels and social media effects to vary by country</span><span class="w">
</span><span class="n">m2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">tech</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">smu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">smu</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wvs_data</span><span class="p">)</span><span class="w">

</span><span class="c1"># Ignore the convergence issue for now.</span><span class="w">

</span><span class="c1"># Linear mixed model fit by REML. t-tests use Satterthwaite's method ['lmerModLmerTest']</span><span class="w">
</span><span class="c1"># Formula: tech ~ 1 + smu + (1 + smu | country)</span><span class="w">
</span><span class="c1">#    Data: wvs_data</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># REML criterion at convergence: 417147.8</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Scaled residuals: </span><span class="w">
</span><span class="c1">#     Min      1Q  Median      3Q     Max </span><span class="w">
</span><span class="c1"># -3.2583 -0.6220  0.1565  0.7311  1.9940 </span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Random effects:</span><span class="w">
</span><span class="c1">#  Groups   Name        Variance Std.Dev. Corr</span><span class="w">
</span><span class="c1">#  country  (Intercept) 0.446825 0.66845      </span><span class="w">
</span><span class="c1">#           smu         0.005858 0.07654  0.16</span><span class="w">
</span><span class="c1">#  Residual             5.656817 2.37841      </span><span class="w">
</span><span class="c1"># Number of obs: 91175, groups:  country, 64</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Fixed effects:</span><span class="w">
</span><span class="c1">#             Estimate Std. Error       df t value Pr(&gt;|t|)    </span><span class="w">
</span><span class="c1"># (Intercept)  7.18065    0.08502 62.92945  84.458  &lt; 2e-16 ***</span><span class="w">
</span><span class="c1"># smu         -0.05403    0.01077 64.85413  -5.017 4.34e-06 ***</span><span class="w">
</span><span class="c1"># ---</span><span class="w">
</span><span class="c1"># Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Correlation of Fixed Effects:</span><span class="w">
</span><span class="c1">#     (Intr)</span><span class="w">
</span><span class="c1"># smu 0.066 </span><span class="w">
</span><span class="c1"># optimizer (nloptwrap) convergence code: 0 (OK)</span><span class="w">
</span><span class="c1"># Model failed to converge with max|grad| = 0.00960965 (tol = 0.002, component 1)</span><span class="w">
</span></code></pre></div></div> <p>Key findings from this more complex model:</p> <p>Fixed Effects:</p> <ul> <li>The average intercept increased slightly to 7.181</li> <li>The negative effect of social media use became stronger (-0.054, <em>p</em> &lt; .001)</li> </ul> <p>Random Effects:</p> <ul> <li>Country-level intercept variance: 0.447 (SD = 0.668)</li> <li>Social media use slope variance: 0.006 (SD = 0.077)</li> </ul> <p>This coefficient is hard to interpret on its own. So let’s try to visulize the results.</p> <h2 id="visualizing-multilevel-mlm-results">Visualizing Multilevel MLM Results</h2> <p>In this part, we’ll explore four different methods to visualize multilevel modeling results, each offering unique insights into our data.</p> <h3 id="method-1-effect-size-visualization-with-bar-plots">Method 1: Effect Size Visualization with Bar Plots</h3> <p>Our first approcah adopts the method of Diehl et al. (2021) to display both the magnitude and direction of effects.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># Extract random effects from the model</span><span class="w">
</span><span class="n">random_effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ranef</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="o">$</span><span class="n">country</span><span class="w">
</span><span class="n">random_effects</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">random_effects</span><span class="p">)</span><span class="w">  </span><span class="c1"># Add country names as a column</span><span class="w">

</span><span class="c1"># Calculate total effects (fixed + random effects)</span><span class="w">
</span><span class="n">fixed_effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fixef</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="w">
</span><span class="n">total_effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">random_effects</span><span class="w">
</span><span class="n">total_effects</span><span class="o">$</span><span class="n">total_smu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fixed_effects</span><span class="p">[</span><span class="s2">"smu"</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">random_effects</span><span class="o">$</span><span class="n">smu</span><span class="w">

</span><span class="c1"># Create the visualization</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">total_effects</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">total_smu</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total_smu</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray50"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Add reference line at zero</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                          </span><span class="c1"># Add effect size bars</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Country"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SMU Effect Size"</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SMU Effect Sizes by Country"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">            </span><span class="c1"># Rotate country labels</span><span class="w">

</span></code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm6.png" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm6.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Advantages of Method 1:</p> <ul> <li>Clear visualization of effect sizes across countries</li> <li>Easy comparison of positive and negative effects</li> <li>Immediate identification of countries with strongest effects</li> <li>Simple to understand for non-technical audiences</li> </ul> <h3 id="method-2-predicted-values-and-country-specific-trends">Method 2: Predicted Values and Country-Specific Trends</h3> <p>The second method focuses on showing how the relationship between SMU and the outcome varies across countries.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># Generate predicted values</span><span class="w">
</span><span class="n">wvs_data</span><span class="o">$</span><span class="n">predicted</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create visualization</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">wvs_data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">smu</span><span class="p">,</span><span class="w"> </span><span class="n">predicted</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">     </span><span class="c1"># Overall trend line</span><span class="w">
  </span><span class="n">stat_smooth</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">),</span><span class="w">                    </span><span class="c1"># Country-specific trends</span><span class="w">
              </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"line"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
              </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                               </span><span class="c1"># Remove legend</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SMU"</span><span class="p">,</span><span class="w"> 
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Predicted Values"</span><span class="p">,</span><span class="w"> 
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SMU-Predicted Value Relationships by Country"</span><span class="p">)</span><span class="w">

</span></code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm7.png" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm7.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Advantages of Method 2:</p> <ul> <li>Shows variation in slopes across countries</li> <li>Displays the overall trend alongside country-specific trends</li> <li>Helps identify countries with divergent patterns</li> <li>Useful for understanding interaction effects</li> </ul> <h3 id="method-3-forest-plot-for-effect-sizes">Method 3: Forest Plot for Effect Sizes</h3> <p>The third method uses a forest plot to display effect sizes with confidence intervals.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calculate necessary components</span><span class="w">
</span><span class="n">random_effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ranef</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="o">$</span><span class="n">country</span><span class="w">
</span><span class="n">random_effects</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">random_effects</span><span class="p">)</span><span class="w">

</span><span class="n">fixed_effect</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fixef</span><span class="p">(</span><span class="n">m2</span><span class="p">)[</span><span class="s2">"smu"</span><span class="p">]</span><span class="w">
</span><span class="n">random_effects</span><span class="o">$</span><span class="n">total_effect</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">random_effects</span><span class="o">$</span><span class="n">smu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fixed_effect</span><span class="w">

</span><span class="c1"># Calculate confidence intervals</span><span class="w">
</span><span class="n">se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">vcov</span><span class="p">(</span><span class="n">m2</span><span class="p">)))[</span><span class="s2">"smu"</span><span class="p">]</span><span class="w">
</span><span class="n">random_effects</span><span class="o">$</span><span class="n">ci_lower</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">random_effects</span><span class="o">$</span><span class="n">total_effect</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1.96</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">se</span><span class="w">
</span><span class="n">random_effects</span><span class="o">$</span><span class="n">ci_upper</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">random_effects</span><span class="o">$</span><span class="n">total_effect</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1.96</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">se</span><span class="w">

</span><span class="c1"># Create forest plot</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">random_effects</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">total_effect</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixed_effect</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray50"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_errorbarh</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ci_lower</span><span class="p">,</span><span class="w"> </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ci_upper</span><span class="p">),</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">total_effect</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#E64B35FF"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="w">
    </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
    </span><span class="n">panel.grid.major.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SMU Effect Size"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Country"</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Forest Plot of SMU Effects by Country"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Dashed line represents overall mean effect"</span><span class="p">)</span><span class="w">

</span></code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm8.png" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm8.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Advantages of Method 3:</p> <ul> <li>Shows uncertainty in effect estimates</li> <li>Clearly displays both effect sizes and their precision</li> <li>Easy comparison with overall mean effect</li> </ul> <h3 id="method-4-random-effects-correlation-plot">Method 4: Random Effects Correlation Plot</h3> <p>By plotting each country’s random intercept against its random slope, we create a “map” that reveals how countries differ in both their baseline values and their SMU effects. This visualization helps us understand the diversity of country-level patterns and their potential relationships.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># Load required packages</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">

</span><span class="c1"># Create scatter plot with labels</span><span class="w">
</span><span class="n">coefs_m2</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">coefs_m2</span><span class="o">$</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">smu</span><span class="p">,</span><span class="w"> </span><span class="n">`(Intercept)`</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                               </span><span class="c1"># Add points</span><span class="w">
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">         </span><span class="c1"># Add trend line</span><span class="w">
  </span><span class="n">geom_text_repel</span><span class="p">(</span><span class="w">                                                    </span><span class="c1"># Add non-overlapping labels</span><span class="w">
    </span><span class="n">box.padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
    </span><span class="n">point.padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w">
    </span><span class="n">segment.color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey50"</span><span class="p">,</span><span class="w">
    </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w">
    </span><span class="n">max.overlaps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Inf</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Slope (SMU Effect)"</span><span class="p">,</span><span class="w"> 
       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Intercept"</span><span class="p">,</span><span class="w">
       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Random Effects: Slope-Intercept Relationship"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project/mlm/mlm9.png" sizes="95vw"></source> <img src="/assets/img/project/mlm/mlm9.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title=" " loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Advantages of Method 4:</p> <ul> <li>Reveals patterns in random effects structure</li> <li>Shows relationship between slopes and intercepts</li> <li>Helps identify outlier countries</li> </ul> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Haotian Zhao. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>